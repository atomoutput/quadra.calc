<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>quadra.calc</title>
    
    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Asynchronously Load Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="assets/icons/icon-192x192.png" sizes="192x192" type="image/png">
    
    <!-- Meta Tags for PWA -->
    <meta name="theme-color" content="#6A5ACD">
    <meta name="description" content="quadra.calc - A PWA inspired by Alesis Quadraverb FX unit for delay setup.">
    
    <!-- Link to CSS -->
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body data-theme="dark">
    
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle Theme">
        <!-- Moon and Sun SVG Icons -->
        <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <!-- Moon Icon -->
            <path id="moon-icon" d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" fill="currentColor"/>
            <!-- Sun Icon (hidden by default) -->
            <path id="sun-icon" d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.8 1.8 1.41-1.42zM10.27 2.05l-1.8 1.8 1.41 1.41 1.8-1.8-1.41-1.41zM12 5a7 7 0 000 14 7 7 0 000-14zm0 12a5 5 0 110-10 5 5 0 010 10zm6.24 1.16l1.79 1.8 1.41-1.41-1.8-1.8-1.41 1.41zM17.16 19.16l1.8 1.8 1.41-1.41-1.8-1.8-1.41 1.41zM12 19a7 7 0 007-7h-2a5 5 0 01-5 5v2z" fill="currentColor" style="display: none;"/>
        </svg>
    </button>

    <!-- Header with Refined Animated Logo -->
    <header class="app-header">
        <!-- Updated Logo: Abstract Musical Note -->
        <svg id="logo" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
            <!-- Abstract Musical Note -->
            <path d="M40 30 L40 70 C40 80, 60 80, 60 70 C60 60, 80 60, 80 70" fill="none" stroke="var(--accent-color)" stroke-width="5" stroke-linecap="round"/>
            <circle cx="70" cy="70" r="5" fill="var(--secondary-accent-color)"/>
            <!-- quadra.calc Text -->
            <text x="50%" y="90%" dominant-baseline="middle" text-anchor="middle" font-size="16" font-weight="700" fill="var(--text-color)" font-family="Roboto, sans-serif">
                quadra.calc
            </text>
        </svg>
    </header>

    <!-- Main Content Grid -->
    <main class="main-grid">
        <!-- BPM Input Card (Smaller Height) -->
        <div class="section card bpm-input-card" aria-labelledby="bpm-section">
            <h2 id="bpm-section">BPM Input</h2>
            <div class="input-group">
                <label for="bpm-input">BPM:</label>
                <input type="number" id="bpm-input" placeholder="Enter BPM" min="30" max="300" aria-required="true">
            </div>
            <div class="tooltip">
                <button id="calculate-btn" class="regular-btn" aria-label="Calculate Delay Times">
                    <!-- Calculate Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14h2V5h14V3zm-7 14l-5-5 1.41-1.41L12 14.17l3.59-3.58L17 10l-5 5z"/>
                    </svg>
                    Calculate
                </button>
                <span class="tooltiptext">Click to calculate delay times based on BPM</span>
            </div>
        </div>

        <!-- Tap Tempo Card (Larger) -->
        <div class="section card tap-tempo-card" aria-labelledby="tap-section">
            <h2 id="tap-section">Tap Tempo</h2>
            <button id="tap-btn" aria-label="Tap to Set BPM">
                <!-- Tap Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13H5v-2h14v2z"/>
                </svg>
                Tap
            </button>
            <div class="tap-indicator">
                <div class="tap-progress" id="tap-progress"></div>
            </div>
            <p id="tap-feedback" class="tap-feedback">Tap the button in time to set BPM.</p>
        </div>

        <!-- Delay Time Suggestions Card -->
        <div class="section card delay-suggestions-card" aria-labelledby="suggestions-section">
            <h2 id="suggestions-section">Delay Time Suggestions</h2>
            <table id="suggestions-table" aria-label="Delay Time Suggestions">
                <thead>
                    <tr>
                        <th>Subdivision</th>
                        <th>Delay (ms)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Suggestions will be populated here -->
                </tbody>
            </table>
            <div class="tooltip">
                <button id="copy-btn" class="regular-btn" aria-label="Copy Delay Times to Clipboard">
                    <!-- Copy Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h15v14z"/>
                    </svg>
                    Copy
                </button>
                <span class="tooltiptext">Copy all delay times to clipboard</span>
            </div>
        </div>

        <!-- Custom Subdivisions Card -->
        <div class="section card custom-subdivisions-card" aria-labelledby="custom-subdivisions-section">
            <h2 id="custom-subdivisions-section">Custom Subdivisions</h2>
            <div class="input-group">
                <label for="subdivision-name">Subdivision Name:</label>
                <input type="text" id="subdivision-name" placeholder="e.g., Dotted Eighth" aria-required="true">
            </div>
            <div class="input-group">
                <label for="subdivision-factor">Factor (relative to quarter note):</label>
                <input type="number" id="subdivision-factor" placeholder="e.g., 1.5" step="0.1" min="0.1" aria-required="true">
            </div>
            <div class="tooltip">
                <button id="add-subdivision-btn" class="regular-btn" aria-label="Add Custom Subdivision">
                    <!-- Add Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                    </svg>
                    Add
                </button>
                <span class="tooltiptext">Add a new custom subdivision</span>
            </div>
            <table id="custom-subdivisions-table" aria-label="Custom Subdivisions">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Factor</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Custom subdivisions will be listed here -->
                </tbody>
            </table>
        </div>

        <!-- Presets Card -->
        <div class="section card presets-card" aria-labelledby="presets-section">
            <h2 id="presets-section">Presets</h2>
            <div class="input-group">
                <label for="preset-name">Preset Name:</label>
                <input type="text" id="preset-name" placeholder="Preset Name" aria-required="true">
            </div>
            <div class="tooltip">
                <button id="save-preset-btn" class="regular-btn" aria-label="Save Current Settings as Preset">
                    <!-- Save Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17 3H5c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 12l-5-2.14L7 15V5h10v10z"/>
                    </svg>
                    Save
                </button>
                <span class="tooltiptext">Save current settings as a preset</span>
            </div>
            <table id="presets-table" aria-label="Saved Presets">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>BPM</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Presets will be listed here -->
                </tbody>
            </table>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification" role="alert" aria-live="assertive">
            <!-- Notification message -->
        </div>

        <!-- Install Button -->
        <button id="install-btn" class="action-button" style="display: none;" aria-label="Install App">
            <!-- Install Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L8 6h3v6h2V6h3l-4-4zM5 18v-2h14v2H5z"/>
            </svg>
            Install
        </button>

        <!-- Help Modal -->
        <div id="help-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="help-modal-title" aria-describedby="help-modal-description">
            <div class="modal-content">
                <span class="close-button" id="close-help-modal" aria-label="Close Help">&times;</span>
                <h2 id="help-modal-title">How to Use quadra.calc</h2>
                <p id="help-modal-description">
                    <ul>
                        <li><strong>BPM Input:</strong> Enter the Beats Per Minute to calculate delay times.</li>
                        <li><strong>Tap Tempo:</strong> Tap the button in rhythm to set BPM automatically.</li>
                        <li><strong>Delay Time Suggestions:</strong> View suggested delay times based on your BPM.</li>
                        <li><strong>Custom Subdivisions:</strong> Add your own subdivisions for personalized delay settings.</li>
                        <li><strong>Presets:</strong> Save and load your favorite delay configurations.</li>
                        <li><strong>Theme Toggle:</strong> Switch between Light and Dark modes for better visibility.</li>
                        <li><strong>Install:</strong> Install quadra.calc as a Progressive Web App for offline access.</li>
                    </ul>
                </p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <p>Â© 2024 quadra.calc. All rights reserved.</p>
            <p>
                <a href="https://github.com/your-repo" target="_blank" rel="noopener noreferrer">GitHub</a> |
                <a href="mailto:contact@quadra.calc">Contact Us</a>
            </p>
        </footer>

        <!-- Link to JavaScript -->
        <script src="scripts/app.js" defer></script>

        <!-- Service Worker Registration -->
        <script>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
                });
            }
        </script>

    </body>
</html>
