<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>quadra.calc</title>

    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">

    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Professional delay time calculator for music production">

    <link rel="stylesheet" href="styles/styles.css">
</head>
<body data-theme="dark">
    <div class="app-container">

        <!-- ========== BPM VIEW ========== -->
        <main class="view" id="view-bpm" data-view="bpm">
            <!-- Minimal Header -->
            <header class="view-header">
                <h1 class="brand">quadra<span>.calc</span></h1>
                <div class="header-actions">
                    <button class="icon-btn" id="metronome-toggle" aria-label="Toggle Metronome" aria-pressed="false">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                    </button>
                    <button class="icon-btn" id="theme-toggle" aria-label="Toggle Theme">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Main BPM Display - Tappable to edit -->
            <section class="bpm-section">
                <div class="bpm-display-container" id="bpm-display-container">
                    <span class="bpm-label">BPM</span>
                    <div class="bpm-value-wrapper">
                        <button class="bpm-adjust" id="bpm-decrease" aria-label="Decrease BPM">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                        </button>
                        <input type="number" class="bpm-value" id="bpm-input" value="120" min="30" max="300" inputmode="numeric" aria-label="BPM Value">
                        <button class="bpm-adjust" id="bpm-increase" aria-label="Increase BPM">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="bpm-quick-actions">
                        <button class="chip-btn" id="bpm-half">รท2</button>
                        <button class="chip-btn" id="bpm-double">ร2</button>
                        <button class="chip-btn" id="midi-sync-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                <circle cx="18" cy="5" r="2"/>
                            </svg>
                            MIDI
                        </button>
                    </div>
                    <div class="midi-status" id="midi-status"></div>
                </div>

                <!-- Beat Visualization -->
                <div class="beat-visualizer">
                    <div class="beat-dot" id="beat-1"></div>
                    <div class="beat-dot" id="beat-2"></div>
                    <div class="beat-dot" id="beat-3"></div>
                    <div class="beat-dot" id="beat-4"></div>
                </div>
            </section>

            <!-- Recent BPMs - Horizontal scroll -->
            <section class="history-strip" id="history-section">
                <div class="history-scroll" id="history-list">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- Quick Results Preview -->
            <section class="quick-results" id="quick-results">
                <div class="quick-result-item">
                    <span class="qr-label">1/4</span>
                    <span class="qr-value" id="qr-quarter">500.00 ms</span>
                </div>
                <div class="quick-result-item">
                    <span class="qr-label">1/8</span>
                    <span class="qr-value" id="qr-eighth">250.00 ms</span>
                </div>
                <div class="quick-result-item">
                    <span class="qr-label">1/16</span>
                    <span class="qr-value" id="qr-sixteenth">125.00 ms</span>
                </div>
                <div class="quick-result-item">
                    <span class="qr-label">1/8T</span>
                    <span class="qr-value" id="qr-triplet">166.67 ms</span>
                </div>
            </section>
        </main>

        <!-- ========== TAP TEMPO VIEW (Main Screen) ========== -->
        <main class="view active" id="view-tap" data-view="tap">
            <!-- Header -->
            <header class="view-header">
                <h1 class="brand">quadra<span>.calc</span></h1>
                <div class="header-actions">
                    <button class="icon-btn" id="metronome-toggle-tap" aria-label="Toggle Metronome" aria-pressed="false">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                    </button>
                    <button class="icon-btn" id="theme-toggle-tap" aria-label="Toggle Theme">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <section class="tap-section">
                <!-- BPM Display - Large and prominent -->
                <div class="tap-bpm-display">
                    <span class="tap-bpm" id="tap-bpm">120</span>
                    <span class="tap-label">BPM</span>
                </div>

                <!-- The Big Tap Button -->
                <button class="tap-button" id="tap-btn" aria-label="Tap for Tempo">
                    <span class="tap-text">TAP</span>
                    <div class="tap-ripple"></div>
                </button>

                <!-- Tap Count & Reset -->
                <div class="tap-controls">
                    <span class="tap-count" id="tap-count">Tap to detect tempo</span>
                    <button class="tap-reset-btn" id="tap-reset">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                        </svg>
                    </button>
                </div>

                <!-- Quick Results - Always visible -->
                <div class="tap-results">
                    <div class="tap-result-item" data-subdivision="quarter">
                        <span class="tap-result-label">1/4</span>
                        <span class="tap-result-value" id="tap-qr-quarter">500.00 ms</span>
                    </div>
                    <div class="tap-result-item" data-subdivision="eighth">
                        <span class="tap-result-label">1/8</span>
                        <span class="tap-result-value" id="tap-qr-eighth">250.00 ms</span>
                    </div>
                    <div class="tap-result-item" data-subdivision="sixteenth">
                        <span class="tap-result-label">1/16</span>
                        <span class="tap-result-value" id="tap-qr-sixteenth">125.00 ms</span>
                    </div>
                    <div class="tap-result-item" data-subdivision="triplet">
                        <span class="tap-result-label">1/8T</span>
                        <span class="tap-result-value" id="tap-qr-triplet">166.67 ms</span>
                    </div>
                    <div class="tap-result-item" data-subdivision="dotted">
                        <span class="tap-result-label">1/8D</span>
                        <span class="tap-result-value" id="tap-qr-dotted">375.00 ms</span>
                    </div>
                    <div class="tap-result-item" data-subdivision="whole">
                        <span class="tap-result-label">1/1</span>
                        <span class="tap-result-value" id="tap-qr-whole">2000.00 ms</span>
                    </div>
                </div>

                <!-- Manual BPM adjust -->
                <div class="tap-bpm-adjust">
                    <button class="tap-adjust-btn" id="tap-bpm-down">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13H5v-2h14v2z"/>
                        </svg>
                    </button>
                    <input type="number" class="tap-bpm-input" id="tap-bpm-input" value="120" min="30" max="300" inputmode="numeric">
                    <button class="tap-adjust-btn" id="tap-bpm-up">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                </div>
            </section>
        </main>

        <!-- ========== RESULTS VIEW ========== -->
        <main class="view" id="view-results" data-view="results">
            <!-- Sticky Header -->
            <header class="results-header">
                <div class="results-bpm">
                    <span class="results-bpm-value" id="results-bpm">120</span>
                    <span class="results-bpm-label">BPM</span>
                </div>
                <div class="results-controls">
                    <select class="mode-select" id="display-mode" aria-label="Display format">
                        <option value="ms">ms</option>
                        <option value="seconds">sec</option>
                        <option value="samples">smp</option>
                        <option value="hz">Hz</option>
                    </select>
                    <button class="icon-btn" id="copy-all-btn" aria-label="Copy all">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Category Filter Chips -->
            <div class="category-filters" id="category-filters">
                <button class="filter-chip active" data-category="all">All</button>
                <button class="filter-chip" data-category="simple">Simple</button>
                <button class="filter-chip" data-category="dotted">Dotted</button>
                <button class="filter-chip" data-category="triplet">Triplet</button>
                <button class="filter-chip" data-category="creative">Creative</button>
            </div>

            <!-- Delay Cards Grid -->
            <div class="delay-list" id="delay-grid">
                <!-- Populated by JS -->
            </div>
        </main>

        <!-- ========== SETTINGS VIEW ========== -->
        <main class="view" id="view-settings" data-view="settings">
            <header class="settings-header">
                <h2>Settings</h2>
            </header>

            <div class="settings-content">
                <!-- Sample Rate -->
                <div class="setting-group">
                    <label class="setting-label">Sample Rate</label>
                    <div class="setting-options" id="sample-rate-options">
                        <button class="option-btn active" data-value="44100">44.1k</button>
                        <button class="option-btn" data-value="48000">48k</button>
                        <button class="option-btn" data-value="96000">96k</button>
                        <button class="option-btn" data-value="192000">192k</button>
                    </div>
                </div>

                <!-- Display Mode -->
                <div class="setting-group">
                    <label class="setting-label">Default Display</label>
                    <div class="setting-options" id="display-mode-options">
                        <button class="option-btn active" data-value="ms">ms</button>
                        <button class="option-btn" data-value="seconds">sec</button>
                        <button class="option-btn" data-value="samples">smp</button>
                        <button class="option-btn" data-value="hz">Hz</button>
                    </div>
                </div>

                <!-- Haptic Feedback -->
                <div class="setting-group">
                    <label class="setting-label">Haptic Feedback</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="haptic-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- Custom Subdivisions -->
                <div class="setting-group">
                    <label class="setting-label">Custom Subdivisions</label>
                    <div class="custom-sub-form">
                        <input type="text" id="subdivision-name" placeholder="Name" class="input-field">
                        <input type="number" id="subdivision-factor" placeholder="Factor" step="0.1" class="input-field input-small">
                        <button class="add-btn" id="add-subdivision-btn">+</button>
                    </div>
                    <div class="custom-list" id="custom-subdivisions-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Presets -->
                <div class="setting-group">
                    <label class="setting-label">Presets</label>
                    <div class="preset-form">
                        <input type="text" id="preset-name" placeholder="Preset name" class="input-field">
                        <button class="add-btn" id="save-preset-btn">Save</button>
                    </div>
                    <div class="presets-list" id="presets-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Export/Share -->
                <div class="setting-group">
                    <label class="setting-label">Data</label>
                    <div class="action-buttons">
                        <button class="action-btn" id="share-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                            </svg>
                            Share
                        </button>
                        <button class="action-btn" id="export-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                            </svg>
                            Export JSON
                        </button>
                    </div>
                </div>

                <!-- About -->
                <div class="setting-group about-section">
                    <p class="app-version">quadra.calc v3.1</p>
                    <p class="app-tagline">Delay calculator for music production</p>
                </div>
            </div>
        </main>

        <!-- ========== BOTTOM NAVIGATION ========== -->
        <nav class="bottom-nav" id="bottom-nav">
            <button class="nav-item active" data-view="tap" aria-label="Tap Tempo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63l-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74l-3.43-.72c-.08-.01-.15-.03-.24-.03-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.21 0-.59-.34-1.15-.91-1.41z"/>
                </svg>
                <span>Tap</span>
            </button>
            <button class="nav-item" data-view="bpm" aria-label="BPM">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                <span>BPM</span>
            </button>
            <button class="nav-item" data-view="results" aria-label="Results">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                </svg>
                <span>Results</span>
            </button>
            <button class="nav-item" data-view="settings" aria-label="Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                </svg>
                <span>More</span>
            </button>
        </nav>

        <!-- Notification Toast -->
        <div class="toast" id="notification" role="alert" aria-live="assertive"></div>

        <!-- Copy Popup -->
        <div class="copy-popup" id="delay-popup" aria-hidden="true">
            <span class="copy-value" id="popup-content"></span>
            <span class="copy-label">Copied!</span>
        </div>

    </div>

    <!-- Hidden tables for legacy support -->
    <table id="suggestions-table" style="display:none;"><tbody></tbody></table>
    <table id="custom-subdivisions-table" style="display:none;"><tbody></tbody></table>
    <table id="presets-table" style="display:none;"><tbody></tbody></table>

    <script src="scripts/app.js" defer></script>
    <script>
        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(console.error);
        }
    </script>
</body>
</html>
